<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>像素画编辑器</title>
    <link rel="stylesheet" href="css/global.css">
</head>
<body>
<div class="container">
    <h1>🎨 像素画编辑器</h1>
    <div class="main-content">
        <div class="canvas-area">
            <div id="canvasWrapper">
                <div id="canvas"></div>
                <div id="previewLayer"></div>
                <div id="selectionLayer"></div>
            </div>
            <!-- 📝 使用说明区域 -->
            <div id="helpSection" class="help-section">
                <h2 style="margin-top:0;">🧭 使用说明</h2>
                <ul>
                    <li><b>按键快捷键</b>：笔刷 B, 橡皮擦 E, 取色 Alt, 填充 F, 选区 M, 网格 G</li>
                    <li><b>撤回与重做</b>：Ctrl + Z 撤回 Ctrl + Y 重做</li>
                    <li><b>选区</b>：长按拖动选取，粘贴后可拖动,Shift + 拖动 叠加选区。按 Enter 放置, Esc 取消</li>
                    <li>——选区支持矩形和手涂两种方式；手涂选取为逐像素切换选中状态。</li>
                    <li><b>Ctrl + C / X / V</b>：复制 / 剪切 / 粘贴选区</li>
                    <li><b>对称模式</b>：将绘制操作对称，试试就知道了</li>
                    <li><b>调色板</b>：因为是做进地图里的所以没法很复杂，就16种颜色，发挥想象力吧()</li>
                    <li><b>颜色重映射</b>：点击两个颜色进行互换, 将颜色重新映射。🎲随机打乱颜色，↩️恢复原始颜色映射</li>
                    <li><b>导入导出</b>：点击右侧导出自动复制到剪贴板，导入会从输入框读取，没有就从剪贴板拿</li>
                    <li><b>导入图片</b>：使用就近颜色和像素强制把图片缩放到画布上</li>
                </ul>
                <p style="margin-top:10px;color:#555;">
                    💡 提示：虽然网页关闭时会自动保存，还请手动保存防止丢失
                </p>
            </div>
        </div>

        <div class="control-panel">
            <div class="panel-section">
                <h3>工具</h3>
                <div class="btn-group">
                    <button id="pen" class="active" title="画笔 B">🖌️ 画笔</button>
                    <button id="eraser" title="橡皮擦 E">🧹 橡皮擦</button>
                    <button id="eyedropper" title="取色 Alt">🎯 取色</button>
                    <button id="line" title="直线">📏 直线</button>
                    <button id="rect" title="矩形">⬛ 矩形</button>
                    <button id="circle" title="圆形">⚪ 圆形</button>
                    <button id="fill" title="填充 F">💧 填充</button>
                    <button id="undo" title="撤回 Ctrl+Z">↩️ 撤回</button>
                    <button id="redo" title="重做 Ctrl+Y">↪️ 重做</button>
                    <button id="clear" style="background:#e74c3c" title="清空">🗑️ 清空</button>
                    <button id="toggleGrid" title="显示/隐藏网格 G">🧩 网格</button>
                </div>
                <div style="margin-top:12px">
                    <strong>选区</strong>
                    <div class="btn-group" style="margin-top:8px">
                        <button id="selRect" title="矩形选取 M (Shift 叠加)">▭ 矩形选取</button>
                        <button id="selFree" title="手涂逐像素选取（再次涂则取消）">✍️ 手涂选取</button>
                        <button id="selMove" title="移动选区 (剪切并粘贴)">⤴️ 移动</button>
                        <button id="selCopy" title="复制选区 Ctrl+C">📄 复制</button>
                        <button id="selCut" title="剪切选区 Ctrl+X">✂️ 剪切</button>
                        <button id="selPaste" title="粘贴 Ctrl+V">📌 粘贴</button>
                        <button id="selClear" title="清除选区 Esc">✖️ 清除选区</button>
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <h3>对称模式</h3>
                <div class="btn-group">
                    <button class="symmetry-btn" data-mode="none" title="无对称">无对称</button>
                    <button class="symmetry-btn" data-mode="horizontal" title="水平镜像">水平镜像</button>
                    <button class="symmetry-btn" data-mode="vertical" title="竖直镜像">竖直镜像</button>
                    <button class="symmetry-btn" data-mode="both" title="双向镜像">双向镜像</button>
                    <button class="symmetry-btn" data-mode="rotate4" title="4向旋转">4向旋转</button>
                    <button class="symmetry-btn" data-mode="rotate8" title="8向旋转">8向旋转</button>
                </div>
            </div>

            <div class="panel-section">
                <h3>调色板</h3>
                <div class="color-palette" id="colorPalette"></div>
                <div style="display:flex;gap:10px;margin-top:10px">
                </div>
                <div id="paletteRemap" style="margin-top:12px;padding:10px;border:1px solid #ccc;border-radius:8px;">
                    <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
                        <strong>🎨 颜色重映射：</strong>
                        <button id="shuffleColors" title="随机打乱调色板顺序">🎲</button>
                        <button id="resetRemap" title="恢复原始顺序">↩️</button>
                    </div>
                    <div id="remapGrid"
                         style="display:grid;grid-template-columns:repeat(auto-fill, 30px);gap:8px;"></div>
                    <small style="color:#666;">点击两个颜色交换它们的映射, 或使用 🎲 随机打乱。</small>
                </div>

            </div>

            <div class="panel-section">
                <h3>导出/导入</h3>
                <div class="btn-group" style="margin-bottom:10px">
                    <button id="exportBtn" style="flex:1">📋 导出/复制到剪贴板</button>
                    <button id="importBtn" style="flex:1;background:#27ae60">📥 导入/从剪贴板导入</button>
                    <button id="importImage" title="导入图片">🖼 导入图片</button>
                </div>
                <textarea id="exportOutput" placeholder="导出的像素画数据会显示在这里..."></textarea>
                <div style="margin-top:8px;font-size:12px;color:#666">💡 每一行形如 <code>- [0, 1, 2, ...]</code>,
                    每个数字代表颜色在调色板中的序号（0-F）, 从左到右、从上到下排列。
                </div>
            </div>
            <div class="panel-section">
                <h3>作品提交</h3>
                <button onclick="window.open('https://wj.qq.com/s2/24356581/974c/', '_blank')">点击前往提交问卷</button>
            </div>
            <div class="panel-section">
                <h3>观看直播解锁更多功能</h3>
                <button id="unlock" style="margin-top:10px;width:100%" onclick="handleUnlockClick()">前往直播间</button>
            </div>
        </div>
    </div>
</div>
<div style="text-align: center;">
    <a>&copy; 2025 Astrorbits NMBCT™ §AZA圣诞活动专用§</a>
</div>

<script src = "./js/utils.js"></script>
<script src = "./js/canvas.js"></script>
<script src = "./js/history.js"></script>
<script src = "./js/tools.js"></script>
<script src = "./js/control.js"></script>
<script src = "./js/aza.js"></script>
<script src = "./js/main.js"></script>

</body>
</html>
